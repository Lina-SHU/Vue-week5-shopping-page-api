<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>購物網站</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
    integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <div id="app">
    <div class="container">
      <!---商品列表-->
      <div class="row d-flex justify-content-center">
        <div class="col-md-8">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">商品圖片</th>
                <th scope="col">商品名稱</th>
                <th scope="col">商品售價</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="product in productList" :key="product.id">
                <td width="25%">
                  <div class="productImg" style="height: 120px; object-fit:cover; background-position: center center;" :style="{'background-image': `url(${product.imageUrl})` }"></div>
                </td>
                <td>{{ product.title }}</td>
                <td>{{ product.price }}</td>
                <td>
                  <button type="button" class="btn btn-outline-secondary" @click="openModal(product.id)">查看更多</button>
                  <button type="button" class="btn btn-primary" @click="addCart(product.id)">加入購物車</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!---購物車列表-->
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <detail-product ref="detailModal" :product="tempProduct"></detail-product>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>


  <script type="module">
    const apiUrl = 'https://vue3-course-api.hexschool.io/';
    const path= 'linachen';

    const app = Vue.createApp({
      data() {
        return {
          productList: {
            "imagesUrl": []
          },
          tempProduct: {}
        }
      },
      methods:{
        getProduct(){
          // 取得商品列表
          const url = `${apiUrl}api/${path}/products`;
          axios.get(url)
          .then(res=>{
            if(res.data.success){
              this.productList = res.data.products;
            }else{
              alert('商品取得失敗');
            }
          })
          .catch(err=>{
            console.log(err);
          })
        },
        openModal(id){
          // 取得單一商品
          const url = `${apiUrl}api/${path}/product/${id}`;
          axios.get(url)
            .then(res => {
              if (res.data.success) {
                this.tempProduct = res.data.product;
              } else {
                alert('商品取得失敗');
              }
            })
            .catch(err => {
              console.log(err);
            })
          this.$refs.detailModal.openModal();
        },
        addCart(id, qty = 1){
          // 加入購物車
          const url = `${apiUrl}api/${path}/products`;
          axios.get(url)
            .then(res => {
              this.productList = res.data.products;
            })
        }
      },
      mounted(){
        this.getProduct();
      }
    });

    app.component('detailProduct', {
      data(){
        return {
          tempProduct: {},
          modal: '',
          qty: 1
        } 
      },
      props:['product'],
      template:`
      <div class="modal fade" ref="detailModal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <!---<div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">{{ tempProduct.title }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>--->
            <div class="modal-body">
              <div class="row">
                <div class="col-md-4">
                  <img :src="tempProduct.imageUrl" alt="produtc picture" class="img-fluid" height="200" >
                </div>
                <div class="col-md-8">
                  <h3>{{ tempProduct.title }}</h3>
                  <p class="text-secondary"><del>原價：{{ tempProduct.origin_price }} 元</del></p>
                  <p class="h4 text-danger">優惠價：{{ tempProduct.price }} 元</p>
                  <div class="input-group mb-3">
                    <input type="number" min="0" :v-model="qty" class="form-control" :value="qty">
                    <button type="button" class="btn btn-primary">加入購物車</button>
                  </div>
                </div>
              </div> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal">關閉</button>
            </div>
          </div>
        </div>
      </div>
      `,
      methods:{
        openModal(){
          this.modal.show();
        }
      },
      watch:{
        product(){
          this.tempProduct = this.product;
        }
      },
      mounted(){
        this.modal = new bootstrap.Modal(this.$refs.detailModal);
      }
    });

    app.mount('#app');
  </script>
</body>

</html>